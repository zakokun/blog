<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.111.3">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>elasticsearch åœ¨æ¼«ç”»æœç´¢é¡¹ç›®çš„åº”ç”¨ï¼ˆä¸€ï¼‰å®‰è£…å’Œéƒ¨ç½²æœç´¢æœåŠ¡v2 &middot; æ‚é±¼å›çš„åšå®¢</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://blog2.zakokun.com/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://blog2.zakokun.com/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://blog2.zakokun.com/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://blog2.zakokun.com/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

</head>

  <body class="theme-base-08 ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://blog2.zakokun.com/"><h1>æ‚é±¼å›çš„åšå®¢</h1></a>
      <p class="lead">
       å¥½åƒæ‡’åšï¼Œçœ¼é«˜æ‰‹ä½ 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="/"> é¦–é¡µ </a></li><li><a href="/categories.html"> åˆ†ç±» </a></li><li><a href="/about/about.html"> å…³äºæˆ‘ </a></li>
      </ul>
    </nav>

    <p>&copy; 2023.Powered by <a target="_blank" href="https://gohugo.io/">Hugo</a> </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>elasticsearch åœ¨æ¼«ç”»æœç´¢é¡¹ç›®çš„åº”ç”¨ï¼ˆä¸€ï¼‰å®‰è£…å’Œéƒ¨ç½²æœç´¢æœåŠ¡v2</h1>
  <time datetime=2020-10-22 class="post-date">2020-10-22</time>
  <p>æ—©æœŸçš„å“”å“©å“”å“©æ¼«ç”»æœç´¢æœåŠ¡æ˜¯ç”±å¤§æ•°æ®éƒ¨é—¨æä¾›çš„ï¼Œå¾ˆå¤šåŠŸèƒ½ä¸Šæ— æ³•æ»¡è¶³æ¼«ç”»è‡ªå·±ä¸šåŠ¡çš„éœ€æ±‚ã€‚æˆ‘ä»¬åœ¨è°ƒç ”äº†ä¸€æ®µæ—¶é—´ elasticsearchï¼ˆåé¢ç®€ç§°ESï¼‰ä»¥åï¼ŒåŠ¨æ‰‹æ­å»ºäº†ä¸€å¥—åŠŸèƒ½é½å…¨çš„æœç´¢æœåŠ¡ã€‚æ¢ç´¢çš„è¿‡ç¨‹æ”¶è·äº†ä¸å°‘ä¸œè¥¿ï¼Œå› æ­¤æ‰“ç®—å†™å‡ ç¯‡ç›¸å…³çš„æ–‡ç« è®°å½•ä¸€ä¸‹ã€‚ä½œä¸ºå¼€ç¯‡ï¼Œç®€å•çš„è®²ä¸€äº›ESçš„æ­å»ºè¿‡ç¨‹å’Œä¸€äº›ç»†èŠ‚ã€‚</p>
<p>The early Bilibili Manga search service is provided by Big Data department,and many functions could not meet the needs of our own business. After a period of investigation, we start to construct a functional search service. We got a lots of exprience in this process so I decide to white some article to record it. As a start, I will go into some details about set up a ES service.</p>
<h1 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡</h1>
<p>åœ¨æˆ‘ä»¬å¼€å§‹åšè°ƒç ”çš„æ—¶å€™ï¼ŒESçš„æœ€æ–°ç‰ˆæœ¬æ˜¯7.6.1ã€‚ä½œä¸ºä¸€ä¸ªæ²¡æœ‰å†å²åŒ…è¢±çš„é¡¹ç›®ï¼Œæœ€æ–°ç‰ˆæœ¬è‡ªç„¶æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚å¯¹æˆ‘ä»¬ä¸€èˆ¬çš„ç”¨æˆ·æ¥è¯´ï¼ŒES7ç›¸æ¯”ä¹‹å‰çš„ç‰ˆæœ¬æœ€å¤§çš„æ”¹å˜æ˜¯å¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>åˆ é™¤typeç±»å‹</li>
<li>æ”¯æŒå‘é‡æœç´¢</li>
<li>è‡ªå¸¦JDKç¯å¢ƒ</li>
</ol>
<p>When we started doing the investigation, the latest version of ES is 7.6.1. As a brand new project,the latest version natural is the best choice. For normal users, the biggest changes from the previous version are as follows:</p>
<ol>
<li>remove &rsquo;type&rsquo; type</li>
<li>vector search support</li>
<li>JDK include</li>
</ol>
<p>åˆ é™¤typeç±»å‹ä»¥åï¼Œç´¢å¼•å’Œå­—æ®µçš„å…³ç³»æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ–¹ä¾¿ä»æ•°æ®åº“çš„è§’åº¦å»ç†è§£ç´¢å¼•ï¼ˆè¡¨ï¼‰å­—æ®µä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚å‘é‡æœç´¢å¯ä»¥ä¸ºç®—æ³•æœåŠ¡æä¾›å‘é‡è¿ç®—å’ŒåŸºäºå‘é‡æ¨¡å‹çš„å¬å›ã€‚è‡ªå¸¦JDKç¯å¢ƒä¸å¿…å¤šè¯´ï¼Œéƒ¨ç½²ESæœåŠ¡æ›´åŠ æ–¹ä¾¿äº†ã€‚</p>
<p>After remove &rsquo;type&rsquo; type,we can clearly understand the relation between index and field,besides,it is also convenient to understand the correspoding relationship between index (table) fields from the database perspective. The vector search provide vector operation and items recall based on vector model for algorithm service.</p>
<p>è¿ç»´ä¸ºæˆ‘ä»¬æä¾›äº†ä¸‰å°ç‰©ç†æœºï¼Œç¡¬ä»¶é…ç½®éƒ½ä¸º24æ ¸128Gå†…å­˜ã€‚é’ˆå¯¹è¿™æ ·é…ç½®çš„æœºå™¨ï¼ŒES å®˜æ–¹æœ‰è¿™æ ·çš„å»ºè®®ï¼š</p>
<p>OPS provide us three physical machines with 24 cores and 128 gigabytes of memory. some official recommendations for machines with this configuration:</p>
<blockquote>
<p>å‡è®¾ä½ æœ‰ä¸ª 128 GB å†…å­˜çš„æœºå™¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å†…å­˜åˆ†é…ä¸è¶…è¿‡ 32 GBã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸è¶…è¿‡ 64 GB å†…å­˜ç»™ ES çš„å †å†…å­˜ï¼Œå‰©ä¸‹çš„è¶…è¿‡ 64 GB çš„å†…å­˜ç»™ Luceneã€‚</p>
</blockquote>
<blockquote>
<p>If you have a 128 GB memory machine, you can create two nodes at most 32 GB memory allocate to each node,which means no more than 64 GB of memory allocate to ES heaps memory,and rest is over 64 GB of memory for Lucene.</p>
</blockquote>
<p>å…·ä½“è¯´æ˜åœ¨<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/heap-sizing.html">è¿™é‡Œ</a></p>
<p>Here is the detail.</p>
<h1 id="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²</h1>
<h2 id="install--deploy">install &amp; deploy</h2>
<p>è‡ªå¸¦ JDK çš„ ES å®‰è£…éå¸¸ç®€å•ï¼Œä¿æŒç€ä¸€è´¯ä»¥æ¥çš„å¼€ç®±å³ç”¨åŸåˆ™ã€‚åªè¦åœ¨æ„å»ºé›†ç¾¤çš„æ—¶å€™ç¨å¾®æ³¨æ„ä¸€ä¸‹é›†ç¾¤çš„é…ç½®å°±å¯ä»¥äº†ã€‚</p>
<p>The installation of ES with JDK is very simple,keeping with the usual out-of-the-box principles. We Just have to focus on the config when you build all the systems.</p>
<p>é¦–å…ˆä»<a href="https://www.elastic.co/cn/downloads/elasticsearch">ä¸‹è½½é¡µé¢</a> ä¸‹è½½ç¬¦åˆè‡ªå·±ç³»ç»Ÿçš„å®‰è£…åŒ…ï¼Œè§£å‹ç¼©ï¼š</p>
<p>First,download the installation package for your own system and unzip from the download page:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tar -zxvf elasticsearch-7.6.1-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span><span style="color:#366">cd</span> elasticsearch
</span></span></code></pre></div><p>å‡ ä¸ªä¸»è¦çš„é…ç½®æ–‡ä»¶ä½äºï¼š</p>
<p>Several major configuration files are located here:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./config/elasticsearch.yml     <span style="color:#09f;font-style:italic"># es è‡ªèº«é…ç½®</span>
</span></span><span style="display:flex;"><span>./config/jvm.options     <span style="color:#09f;font-style:italic"># jvm ç›¸å…³é…ç½®</span>
</span></span></code></pre></div><p><code>elasticsearch.yml</code> ä¸­å‡ ä¸ªé‡ç‚¹çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<p>the point of <code>elasticsearch.yml</code> is:</p>
<h2 id="é‡ç‚¹é…ç½®é¡¹">é‡ç‚¹é…ç½®é¡¹</h2>
<h3 id="clustername">cluster.name</h3>
<p>é›†ç¾¤åç§°ï¼ŒåŒé›†ç¾¤ä¸‹çš„èŠ‚ç‚¹é…ç½®å¿…é¡»ç›¸åŒã€‚</p>
<p>The special name of cluster. Each node configuration must keep the same under a cluster.</p>
<h3 id="nodename">node.name</h3>
<p>èŠ‚ç‚¹åç§°ï¼ŒåŒé›†ç¾¤ä¸‹ä¸åŒèŠ‚ç‚¹åç§°ä¸èƒ½ç›¸åŒã€‚</p>
<p>The special name of node. Each node configuration must keep different under a cluster.</p>
<h3 id="nodedata--nodemaster">node.data | node.master</h3>
<p>èŠ‚ç‚¹ç±»å‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯ master èŠ‚ç‚¹ï¼Œè¦ä¹ˆæ˜¯ data èŠ‚ç‚¹ï¼Œè¿™æ ·æ‹†åˆ†æ›´åˆç†ã€‚</p>
<p>node type. generally, a node either a master node or a data node. It makes more sense to split it this way.</p>
<h3 id="pathdata--pathlogs">path.data | path.logs</h3>
<p>æ•°æ®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶å‚¨å­˜ç›®å½•ã€‚</p>
<p>The storage directory of data file and log file.</p>
<h3 id="httpport">http.port</h3>
<p>æœç´¢ API æœåŠ¡ç«¯å£å·ï¼Œé»˜è®¤9200ã€‚</p>
<p>The port user for API service, deafult 9200.</p>
<h3 id="transportport">transport.port</h3>
<p>elasticsearché›†ç¾¤å†…æ•°æ®é€šè®¯ä½¿ç”¨çš„ç«¯å£ï¼Œé»˜è®¤9300ã€‚</p>
<p>The port user for data transport within the cluser, default 9300.</p>
<h3 id="discoveryseed_hosts">discovery.seed_hosts</h3>
<p>æŒ‡å®šé›†ç¾¤æ‰«æçš„ IP å’Œç«¯å£å·ï¼Œä¾¿äºå‘ç°é›†ç¾¤èŠ‚ç‚¹çº³å…¥é›†ç¾¤ã€‚</p>
<p>Assign IP and PORT to cluster discovery for find out and include into cluster easily.</p>
<p>å› æ­¤ä¸€ä¸ªå®Œæ•´çš„ master èŠ‚ç‚¹é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<p>So, the content of complete master node configuration file is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#309;font-weight:bold">cluster.name</span>:<span style="color:#bbb"> </span>my_cluster_name<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">node.name</span>:<span style="color:#bbb"> </span>node1<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">node.master</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">node.data</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">path.data</span>:<span style="color:#bbb"> </span>/mnt/storage01/esdata<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">path.logs</span>:<span style="color:#bbb"> </span>/mnt/storage01/log/elasticsearch<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">bootstrap.memory_lock</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">bootstrap.system_call_filter</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">network.host</span>:<span style="color:#bbb"> </span><span style="color:#f60">0.0.0.0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">http.port</span>:<span style="color:#bbb"> </span><span style="color:#f60">9212</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">transport.tcp.port</span>:<span style="color:#bbb"> </span><span style="color:#f60">9312</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">discovery.seed_hosts</span>:<span style="color:#bbb"> </span>[<span style="color:#c30">&#39;10.70.54.28:9311&#39;</span>,<span style="color:#c30">&#39;10.70.54.28:9312&#39;</span>,<span style="color:#c30">&#39;10.70.54.27:9312&#39;</span>,<span style="color:#c30">&#39;10.70.54.27:9311&#39;</span>,<span style="color:#c30">&#39;10.70.54.26:9312&#39;</span>]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">http.cors.enabled</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">http.cors.allow-origin</span>:<span style="color:#bbb"> </span><span style="color:#c30">&#34;*&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">indices.memory.index_buffer_size</span>:<span style="color:#bbb"> </span><span style="color:#f60">40</span>%<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">thread_pool.write.queue_size</span>:<span style="color:#bbb"> </span><span style="color:#f60">1024</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>åŒç†ï¼Œä¸€ä¸ª data èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p>Similarly, the configuration file for a data node is as follows:</p>
<aside>
ğŸ’¡ æ³¨æ„ node.master å’Œ node.data çš„åŒºåˆ«
</aside>
<aside>
ğŸ’¡ notice the different of node.master and node.data
</aside>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#309;font-weight:bold">cluster.name</span>:<span style="color:#bbb"> </span>my_cluster_name<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">node.name</span>:<span style="color:#bbb"> </span>node2<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">node.master</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">node.data</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">path.data</span>:<span style="color:#bbb"> </span>/mnt/storage01/esdata<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">path.logs</span>:<span style="color:#bbb"> </span>/mnt/storage01/log/elasticsearch<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">bootstrap.memory_lock</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">bootstrap.system_call_filter</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">network.host</span>:<span style="color:#bbb"> </span><span style="color:#f60">0.0.0.0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">http.port</span>:<span style="color:#bbb"> </span><span style="color:#f60">9211</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">transport.tcp.port</span>:<span style="color:#bbb"> </span><span style="color:#f60">9311</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">discovery.seed_hosts</span>:<span style="color:#bbb"> </span>[<span style="color:#c30">&#39;10.70.54.28:9311&#39;</span>,<span style="color:#c30">&#39;10.70.54.28:9312&#39;</span>,<span style="color:#c30">&#39;10.70.54.27:9312&#39;</span>,<span style="color:#c30">&#39;10.70.54.27:9311&#39;</span>,<span style="color:#c30">&#39;10.70.54.26:9312&#39;</span>]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">http.cors.enabled</span>:<span style="color:#bbb"> </span><span style="color:#069;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">http.cors.allow-origin</span>:<span style="color:#bbb"> </span><span style="color:#c30">&#34;*&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">indices.memory.index_buffer_size</span>:<span style="color:#bbb"> </span><span style="color:#f60">40</span>%<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#309;font-weight:bold">thread_pool.write.queue_size</span>:<span style="color:#bbb"> </span><span style="color:#f60">1024</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>è€Œ jvm.options æ–‡ä»¶å°±å¾ˆç®€å•ï¼Œéœ€è¦æ”¹çš„åªæœ‰ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<p>And <code>jvm.options</code> file is simple,you just need change this two parts:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-Xms30g
</span></span><span style="display:flex;"><span>-Xmx30g
</span></span></code></pre></div><p>æŒ‡å®šæœ€å°å’Œæœ€å¤§å †å†…å­˜éƒ½ä¸º30GBã€‚</p>
<p>Specifies the minimum and maximum heaps memory sizes.</p>
<p>éƒ½è®¾ç½®å¥½äº†ä»¥åï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªè¿è¡ŒesæœåŠ¡çš„ç”¨æˆ·ï¼Œesä¸å…è®¸ä½¿ç”¨rootè´¦æˆ·ç›´æ¥è¿è¡Œï¼Œå› æ­¤ï¼š</p>
<p>After all set up, we need to create a specified user for ES,root user is not allowed.So:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>adduser --disabled-password --gecos <span style="color:#c30">&#34;&#34;</span> es
</span></span><span style="display:flex;"><span>chown -R es:es elasticsearch
</span></span></code></pre></div><p>ä¸è¿‡ä¸€èˆ¬æ¥è¯´ç¬¬ä¸€æ¬¡è¿è¡ŒESæœåŠ¡è¿˜ä¼šé¢å¤–æŠ¥ä¸€ä¸ªé”™è¯¯ï¼š</p>
<p>But if we run ES service at first time,we may get another error:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>max virtual memory areas vm.max_map_count <span style="color:#555">[</span>65530<span style="color:#555">]</span> is too low, increase to at least <span style="color:#555">[</span>262144<span style="color:#555">]</span>
</span></span></code></pre></div><p>å‚è€ƒstackoverflowä¸Šçš„è¿™ä¸ª<a href="https://stackoverflow.com/questions/51445846/elasticsearch-max-virtual-memory-areas-vm-max-map-count-65530-is-too-low-inc">å›ç­”</a>:</p>
<p>We can refer to this answer in stackoverflow:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sysctl -w vm.max_map_count<span style="color:#555">=</span><span style="color:#f60">262144</span>
</span></span></code></pre></div><p>æˆ–è€…ä¸€æ­¥åˆ°ä½ï¼Œç›´æ¥å»ä¿®æ”¹ç³»ç»Ÿçš„é…ç½®é¡¹ï¼Œæ–°å¢ä¸€è¡Œï¼š</p>
<p>Or go ahead and change the system configuration and add a new line:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim /etc/sysctl.conf
</span></span><span style="display:flex;"><span>vm.max_map_count<span style="color:#555">=</span><span style="color:#f60">262144</span>
</span></span></code></pre></div><p>æœ€åï¼Œç›´æ¥æ‰§è¡Œ <code>bin/elasticsearch -d</code> å°±å¯ä»¥äº†ã€‚</p>
<p>After all set up, it is ok to execute <code>bin/elasticsearch -d</code> directly.</p>

</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "evanszhang" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-62768625-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
  </body>
</html>
